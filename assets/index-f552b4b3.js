import"./main-8913e1af.js";document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".recommendation-wall");e.style.cursor="grab";let t={top:0,left:0,x:0,y:0};const r=function(c){e.style.cursor="grabbing",e.style.userSelect="none",t={left:e.scrollLeft,top:e.scrollTop,x:c.clientX,y:c.clientY},document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)},n=function(c){const l=c.clientX-t.x,E=c.clientY-t.y;e.scrollTop=t.top-E,e.scrollLeft=t.left-l},o=function(){e.style.cursor="grab",e.style.removeProperty("user-select"),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};e.addEventListener("mousedown",r)});let L=document.querySelector(".menuToggle"),q=document.querySelectorAll(".topBar-menu a"),d=document.querySelector(".topBar-menu");L.addEventListener("click",S);q.forEach(e=>{e.addEventListener("click",b)});function S(){d.classList.contains("openMenu")?d.classList.remove("openMenu"):d.classList.add("openMenu")}function b(){d.classList.remove("openMenu")}const a="https://livejs-api.hexschool.io/api/livejs/v1/customer",s="rxzan",p=document.querySelector(".productWrap"),N=document.querySelector(".productSelect"),g=document.querySelector(".shoppingCart-tableList");let f=[],i=[];function I(){x(),u()}I();function x(){axios.get(`${a}/${s}/products`).then(function(e){f=e.data.products,y()}).catch(function(e){console.log(e.response.data)})}function y(){let e="";f.forEach(t=>{e+=v(t),p.innerHTML=e})}N.addEventListener("change",e=>{console.log(e.target.value);const t=e.target.value;if(t=="全部"){y();return}let r="";f.forEach(n=>{n.category==t&&(r+=v(n))}),p.innerHTML=r});function v(e){return`
    <li class="productCard">
    <h4 class="productType">${e.category}</h4>
    <img
    src="${e.images}"
    alt=""
    />
    <a href="#" class="addCardBtn" data-id="${e.id}" data-product="${e.title}">加入購物車</a>
    <h3>${e.title}</h3>
    <del class="originPrice">NT$ ${new Intl.NumberFormat("en-IN").format(e.origin_price)}</del>
    <p class="nowPrice">NT$ ${new Intl.NumberFormat("en-IN").format(e.price)}</p>
    </li>
    `}p.addEventListener("click",e=>{if(e.preventDefault(),e.target.getAttribute("class")!=="addCardBtn")return;let r=e.target.getAttribute("data-id"),n=1;i.forEach(o=>{o.product.id===r&&(n=o.quantity+=1)}),axios.post(`${a}/${s}/carts`,{data:{productId:r,quantity:n}}).then(function(o){const c=e.target.getAttribute("data-product");alert(`"${c}" 已加入購物車`),u()}).catch(function(o){console.log(o.response.data)})});function u(){axios.get(`${a}/${s}/carts`).then(function(e){i=e.data.carts,document.querySelector(".js-total").textContent=new Intl.NumberFormat("en-IN").format(e.data.finalTotal);let t="";i.forEach(r=>{t+=`
                <tr>
                    <td>
                        <div class="cardItem-title">
                            <img src="${r.product.images}" alt="" />
                            <p>${r.product.title}</p>
                        </div>
                    </td>
                    <td>NT$${new Intl.NumberFormat("en-IN").format(r.product.price)}</td>
                    <td>${r.quantity}</td>
                    <td>NT$${new Intl.NumberFormat("en-IN").format(r.product.price*r.quantity)}</td>
                    <td class="discardBtn">
                        <a href="#" class="material-icons" data-id="${r.id}" data-product="${r.product.title}"> clear </a>
                    </td>
                </tr>
                `}),g.innerHTML=t}).catch(function(e){console.log(e.response.data)})}g.addEventListener("click",e=>{e.preventDefault();const t=e.target.getAttribute("data-id"),r=e.target.getAttribute("data-product");t!=null&&axios.delete(`${a}/${s}/carts/${t}`).then(function(n){alert(`已刪除 "${r}"`),u()}).catch(function(n){console.log(n.response.data)})});const A=document.querySelector(".discardAllBtn");A.addEventListener("click",e=>{e.preventDefault(),axios.delete(`${a}/${s}/carts`).then(function(t){alert("已刪除所有購物車內容"),u()}).catch(function(t){alert("購物車中已無商品")})});const C=document.querySelector(".orderInfo-btn");C.addEventListener("click",e=>{if(e.preventDefault(),i.length==0){alert("訂單送出失敗：購物車中沒有任何商品");return}const t=document.querySelector("#customerName").value,r=document.querySelector("#customerPhone").value,n=document.querySelector("#customerEmail").value,o=document.querySelector("#customerAddress").value,c=document.querySelector("#tradeWay").value;if(t==""||r==""||n==""||o==""||c==""){alert("還有資料未填寫");return}P(),axios.post(`${a}/${s}/orders`,{data:{user:{name:t,tel:r,email:n,address:o,payment:c}}}).then(function(l){alert("成功送出訂單"),document.querySelector("#customerName").value="",document.querySelector("#customerPhone").value="",document.querySelector("#customerEmail").value="",document.querySelector("#customerAddress").value="",document.querySelector("#tradeWay").value="ATM",u()}).catch(function(l){console.log(l.response.data)})});const m=document.querySelector("#customerEmail");m.addEventListener("blur",function(e){if($(m.value)==!1){document.querySelector("[data-message=Email]").textContent="請填寫正確 Email 格式";return}});const h=document.querySelectorAll("input[name],select[data=payment]");console.log(h);const T=document.querySelector(".orderInfo-form"),M={姓名:{presence:{message:"必填欄位"}},電話:{presence:{message:"必填欄位"},length:{minimum:8,message:"需超過 8 碼"}},信箱:{presence:{message:"必填欄位"},email:{message:"格式錯誤"}},寄送地址:{presence:{message:"必填欄位"}},交易方式:{presence:{message:"必填欄位"}}};h.forEach(e=>{e.addEventListener("change",function(){e.nextElementSibling.textContent="";let t=validate(T,M)||"";t&&Object.keys(t).forEach(function(r){console.log(document.querySelector(`[data-message=${r}]`)),document.querySelector(`[data-message="${r}"]`).textContent=t[r]})})});function $(e){return!!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e)}function P(){if(!$(m)){alert("email 格式有誤！");return}}
